# ç™»å‡ºåŠŸèƒ½å®ç°æ–¹æ¡ˆ - ä¼ä¸šçº§æœ€ä½³å®è·µ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¶é—´**: 2026-01-21  
> **ç›®æ ‡**: è®¾è®¡ç¬¦åˆä¼ä¸šçº§æ ‡å‡†çš„ç™»å‡ºåŠŸèƒ½

---

## ğŸ“Š ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ

### 1.1 ç°æœ‰å®ç°

**å‰ç«¯ç™»å‡ºé€»è¾‘**ï¼ˆ`PortalLayout.tsx`ï¼‰:
```typescript
const onLogout = () => {
  clearToken();  // åªæ¸…é™¤localStorage
  navigate('/login');
};
```

**é—®é¢˜**ï¼š
- âŒ æ²¡æœ‰é€šçŸ¥åç«¯ç”¨æˆ·å·²ç™»å‡º
- âŒ JWT Tokenä»ç„¶æœ‰æ•ˆï¼ˆç›´åˆ°è¿‡æœŸï¼‰
- âŒ æ— æ³•æ¸…é™¤æœåŠ¡ç«¯çŠ¶æ€ï¼ˆåœ¨çº¿çŠ¶æ€ã€Redisç¼“å­˜ç­‰ï¼‰
- âŒ æ— æ³•å®ç°"å¼ºåˆ¶ä¸‹çº¿"åŠŸèƒ½
- âŒ æ— æ³•ç»Ÿè®¡ç™»å‡ºæ—¥å¿—

---

## ğŸ¯ äºŒã€æ–¹æ¡ˆå¯¹æ¯”

### 2.1 æ–¹æ¡ˆAï¼šçº¯å‰ç«¯ç™»å‡ºï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

**å®ç°**ï¼šåªæ¸…é™¤å‰ç«¯localStorage

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•å¿«é€Ÿ
- âœ… æ— éœ€åç«¯æ”¯æŒ

**ç¼ºç‚¹**ï¼š
- âŒ Tokenä»ç„¶æœ‰æ•ˆï¼ˆå®‰å…¨é£é™©ï¼‰
- âŒ æ— æ³•æ¸…é™¤æœåŠ¡ç«¯çŠ¶æ€
- âŒ æ— æ³•å®ç°å¼ºåˆ¶ä¸‹çº¿
- âŒ ä¸ç¬¦åˆä¼ä¸šçº§å®‰å…¨æ ‡å‡†

**é€‚ç”¨åœºæ™¯**ï¼šä»…ç”¨äºå¼€å‘/æµ‹è¯•ç¯å¢ƒ

---

### 2.2 æ–¹æ¡ˆBï¼šåç«¯ç™»å‡ºæ¥å£ + Tokené»‘åå•ï¼ˆæ¨èï¼‰

**å®ç°**ï¼š
1. å‰ç«¯è°ƒç”¨ç™»å‡ºæ¥å£
2. åç«¯å°†TokenåŠ å…¥é»‘åå•ï¼ˆRedisï¼‰
3. åç«¯æ¸…é™¤ç”¨æˆ·åœ¨çº¿çŠ¶æ€
4. JWT Filteræ£€æŸ¥é»‘åå•

**ä¼˜ç‚¹**ï¼š
- âœ… å®‰å…¨æ€§é«˜ï¼ˆTokenç«‹å³å¤±æ•ˆï¼‰
- âœ… å¯ä»¥æ¸…é™¤æœåŠ¡ç«¯çŠ¶æ€
- âœ… æ”¯æŒå¼ºåˆ¶ä¸‹çº¿
- âœ… ç¬¦åˆä¼ä¸šçº§æ ‡å‡†

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦Rediså­˜å‚¨é»‘åå•
- âš ï¸ æ¯æ¬¡è¯·æ±‚éœ€è¦æ£€æŸ¥é»‘åå•ï¼ˆæ€§èƒ½å½±å“å°ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š**ç”Ÿäº§ç¯å¢ƒæ¨è**

---

### 2.3 æ–¹æ¡ˆCï¼šåç«¯ç™»å‡ºæ¥å£ + çŸ­Tokenè¿‡æœŸæ—¶é—´

**å®ç°**ï¼š
1. å‰ç«¯è°ƒç”¨ç™»å‡ºæ¥å£
2. åç«¯æ¸…é™¤ç”¨æˆ·çŠ¶æ€
3. Tokenä¾èµ–è¿‡æœŸæ—¶é—´è‡ªç„¶å¤±æ•ˆ

**ä¼˜ç‚¹**ï¼š
- âœ… å®ç°ç®€å•
- âœ… æ— éœ€é»‘åå•

**ç¼ºç‚¹**ï¼š
- âŒ Tokenåœ¨è¿‡æœŸå‰ä»ç„¶æœ‰æ•ˆï¼ˆå®‰å…¨é£é™©ï¼‰
- âŒ æ— æ³•ç«‹å³å¤±æ•ˆToken

**é€‚ç”¨åœºæ™¯**ï¼šå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯

---

## âœ… ä¸‰ã€æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆBï¼ˆTokené»‘åå•ï¼‰

### 3.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ç™»å‡º    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/logout
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ç™»å‡ºæ¥å£             â”‚
â”‚  1. éªŒè¯Token            â”‚
â”‚  2. åŠ å…¥é»‘åå•(Redis)     â”‚
â”‚  3. æ¸…é™¤åœ¨çº¿çŠ¶æ€          â”‚
â”‚  4. è¿”å›æˆåŠŸ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Filter             â”‚
â”‚  æ¯æ¬¡è¯·æ±‚æ£€æŸ¥é»‘åå•        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å®ç°æ­¥éª¤

#### æ­¥éª¤1ï¼šåˆ›å»ºTokené»‘åå•æœåŠ¡

**æ–‡ä»¶**: `src/main/java/com/ityfz/yulu/common/security/TokenBlacklistService.java`

```java
package com.ityfz.yulu.common.security;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

import java.util.concurrent.TimeUnit;

/**
 * Tokené»‘åå•æœåŠ¡
 * ç”¨äºå®ç°ç™»å‡ºåŠŸèƒ½ï¼Œä½¿Tokenç«‹å³å¤±æ•ˆ
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class TokenBlacklistService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    
    private static final String BLACKLIST_KEY_PREFIX = "token:blacklist:";
    
    /**
     * é»˜è®¤Tokenè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºè®¾ç½®é»‘åå•TTL
     * åº”è¯¥ä¸JWT Tokençš„è¿‡æœŸæ—¶é—´ä¸€è‡´
     */
    private static final long DEFAULT_TOKEN_EXPIRE_SECONDS = 7 * 24 * 3600; // 7å¤©
    
    /**
     * å°†TokenåŠ å…¥é»‘åå•
     * 
     * @param token JWT Token
     * @param expireSeconds è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¦‚æœä¸ºnullåˆ™ä½¿ç”¨é»˜è®¤å€¼
     */
    public void addToBlacklist(String token, Long expireSeconds) {
        if (token == null || token.trim().isEmpty()) {
            return;
        }
        
        String key = BLACKLIST_KEY_PREFIX + token;
        long ttl = expireSeconds != null ? expireSeconds : DEFAULT_TOKEN_EXPIRE_SECONDS;
        
        redisTemplate.opsForValue().set(key, "1", ttl, TimeUnit.SECONDS);
        
        log.info("[TokenBlacklist] Tokenå·²åŠ å…¥é»‘åå•ï¼ŒTTL={}ç§’", ttl);
    }
    
    /**
     * æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­
     * 
     * @param token JWT Token
     * @return true-åœ¨é»‘åå•ä¸­ï¼Œfalse-ä¸åœ¨
     */
    public boolean isBlacklisted(String token) {
        if (token == null || token.trim().isEmpty()) {
            return false;
        }
        
        String key = BLACKLIST_KEY_PREFIX + token;
        Boolean exists = redisTemplate.hasKey(key);
        
        return Boolean.TRUE.equals(exists);
    }
    
    /**
     * ä»é»‘åå•ç§»é™¤Tokenï¼ˆä¸€èˆ¬ä¸éœ€è¦ï¼Œç­‰TTLè¿‡æœŸå³å¯ï¼‰
     * 
     * @param token JWT Token
     */
    public void removeFromBlacklist(String token) {
        if (token == null || token.trim().isEmpty()) {
            return;
        }
        
        String key = BLACKLIST_KEY_PREFIX + token;
        redisTemplate.delete(key);
        
        log.info("[TokenBlacklist] Tokenå·²ä»é»‘åå•ç§»é™¤");
    }
}
```

#### æ­¥éª¤2ï¼šä¿®æ”¹JWT Filteræ£€æŸ¥é»‘åå•

**æ–‡ä»¶**: `src/main/java/com/ityfz/yulu/common/security/JwtAuthFilter.java`

```java
// åœ¨ doFilterInternal æ–¹æ³•ä¸­ï¼ŒéªŒè¯Tokenåæ·»åŠ é»‘åå•æ£€æŸ¥

@Override
protected void doFilterInternal(HttpServletRequest request, 
                                HttpServletResponse response, 
                                FilterChain filterChain) throws ServletException, IOException {
    
    String token = extractToken(request);
    
    if (token == null) {
        filterChain.doFilter(request, response);
        return;
    }
    
    try {
        // 1. éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
        Claims claims = jwtUtil.parseToken(token);
        if (claims == null) {
            filterChain.doFilter(request, response);
            return;
        }
        
        // 2. æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼ˆæ–°å¢ï¼‰
        if (tokenBlacklistService.isBlacklisted(token)) {
            log.warn("[JWT] Tokenå·²è¢«åŠ å…¥é»‘åå•: {}", token.substring(0, 20) + "...");
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write("{\"code\":\"401\",\"message\":\"Tokenå·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•\"}");
            return;
        }
        
        // 3. è®¾ç½®ä¸Šä¸‹æ–‡ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
        Long userId = Long.parseLong(claims.getSubject());
        Long tenantId = claims.get("tenantId", Long.class);
        String role = claims.get("role", String.class);
        
        TenantContextHolder.setTenantId(tenantId);
        UserContextHolder.setUserId(userId);
        UserContextHolder.setRole(role);
        
        filterChain.doFilter(request, response);
        
    } catch (Exception e) {
        log.error("[JWT] TokenéªŒè¯å¤±è´¥", e);
        filterChain.doFilter(request, response);
    } finally {
        TenantContextHolder.clear();
        UserContextHolder.clear();
    }
}
```

**æ³¨æ„**ï¼šéœ€è¦åœ¨ `JwtAuthFilter` ä¸­æ³¨å…¥ `TokenBlacklistService`ï¼š
```java
@RequiredArgsConstructor
public class JwtAuthFilter extends OncePerRequestFilter {
    private final JwtUtil jwtUtil;
    private final TokenBlacklistService tokenBlacklistService; // æ–°å¢
    
    // ...
}
```

#### æ­¥éª¤3ï¼šåˆ›å»ºç»Ÿä¸€ç™»å‡ºController

**æ–‡ä»¶**: `src/main/java/com/ityfz/yulu/common/controller/AuthController.java` (æ–°å»º)

```java
package com.ityfz.yulu.common.controller;

import com.ityfz.yulu.common.annotation.RequireRole;
import com.ityfz.yulu.common.enums.ErrorCodes;
import com.ityfz.yulu.common.enums.Roles;
import com.ityfz.yulu.common.exception.BizException;
import com.ityfz.yulu.common.model.ApiResponse;
import com.ityfz.yulu.common.security.JwtUtil;
import com.ityfz.yulu.common.security.SecurityUtil;
import com.ityfz.yulu.common.security.TokenBlacklistService;
import com.ityfz.yulu.user.service.AgentStatusService;
import io.jsonwebtoken.Claims;
import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * ç»Ÿä¸€è®¤è¯Controllerï¼ˆç™»å½•/ç™»å‡ºï¼‰
 */
@Slf4j
@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
public class AuthController {
    
    private final TokenBlacklistService tokenBlacklistService;
    private final AgentStatusService agentStatusService;
    private final JwtUtil jwtUtil;
    
    /**
     * ç»Ÿä¸€ç™»å‡ºæ¥å£
     * POST /api/logout
     * 
     * æ”¯æŒæ‰€æœ‰è§’è‰²ï¼ˆUSER/ADMIN/AGENTï¼‰
     */
    @PostMapping("/logout")
    public ApiResponse<Void> logout(HttpServletRequest request) {
        // 1. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        Long tenantId = SecurityUtil.currentTenantId();
        Long userId = SecurityUtil.currentUserId();
        String role = SecurityUtil.currentRole();
        
        if (tenantId == null || userId == null) {
            // å¦‚æœæ²¡æœ‰ç™»å½•ä¿¡æ¯ï¼Œç›´æ¥è¿”å›æˆåŠŸï¼ˆé¿å…é‡å¤ç™»å‡ºæŠ¥é”™ï¼‰
            return ApiResponse.success("ç™»å‡ºæˆåŠŸ");
        }
        
        // 2. æå–Token
        String token = extractToken(request);
        
        // 3. å°†TokenåŠ å…¥é»‘åå•
        if (token != null) {
            // è®¡ç®—Tokenå‰©ä½™æœ‰æ•ˆæ—¶é—´ï¼Œè®¾ç½®é»‘åå•TTL
            Long expireSeconds = calculateTokenExpireSeconds(token);
            tokenBlacklistService.addToBlacklist(token, expireSeconds);
            log.info("[Logout] Tokenå·²åŠ å…¥é»‘åå•: userId={}, tenantId={}", userId, tenantId);
        }
        
        // 4. æ¸…é™¤å®¢æœåœ¨çº¿çŠ¶æ€ï¼ˆå¦‚æœæ˜¯å®¢æœæˆ–ç®¡ç†å‘˜ï¼‰
        if (Roles.isAgent(role) || Roles.isAdmin(role)) {
            try {
                agentStatusService.setOffline(tenantId, userId);
                log.info("[Logout] å®¢æœçŠ¶æ€å·²æ¸…é™¤: userId={}, tenantId={}", userId, tenantId);
            } catch (Exception e) {
                log.warn("[Logout] æ¸…é™¤å®¢æœçŠ¶æ€å¤±è´¥", e);
                // ä¸å½±å“ç™»å‡ºæµç¨‹ï¼Œç»§ç»­æ‰§è¡Œ
            }
        }
        
        // 5. è®°å½•ç™»å‡ºæ—¥å¿—ï¼ˆå¯é€‰ï¼‰
        log.info("[Logout] ç”¨æˆ·ç™»å‡ºæˆåŠŸ: userId={}, tenantId={}, role={}", userId, tenantId, role);
        
        return ApiResponse.success("ç™»å‡ºæˆåŠŸ");
    }
    
    /**
     * ä»è¯·æ±‚ä¸­æå–Token
     */
    private String extractToken(HttpServletRequest request) {
        String authHeader = request.getHeader("Authorization");
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            return authHeader.substring(7);
        }
        return null;
    }
    
    /**
     * è®¡ç®—Tokenå‰©ä½™æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰
     */
    private Long calculateTokenExpireSeconds(String token) {
        try {
            Claims claims = jwtUtil.parseToken(token);
            if (claims == null || claims.getExpiration() == null) {
                return null; // ä½¿ç”¨é»˜è®¤TTL
            }
            
            long expireTime = claims.getExpiration().getTime();
            long currentTime = System.currentTimeMillis();
            long remainSeconds = (expireTime - currentTime) / 1000;
            
            // å¦‚æœå·²ç»è¿‡æœŸï¼Œè¿”å›nullï¼ˆä½¿ç”¨é»˜è®¤TTLï¼‰
            if (remainSeconds <= 0) {
                return null;
            }
            
            return remainSeconds;
        } catch (Exception e) {
            log.warn("[Logout] è®¡ç®—Tokenè¿‡æœŸæ—¶é—´å¤±è´¥", e);
            return null; // ä½¿ç”¨é»˜è®¤TTL
        }
    }
}
```

#### æ­¥éª¤4ï¼šå‰ç«¯APIæ‰©å±•

**æ–‡ä»¶**: `frontend/src/api/auth.ts`

```typescript
export const authApi = {
  // ... ç°æœ‰æ–¹æ³• ...
  
  // ç»Ÿä¸€ç™»å‡ºæ¥å£
  logout() {
    return http.post<ApiResponse<void>>('/logout');
  }
};
```

#### æ­¥éª¤5ï¼šå‰ç«¯ç™»å‡ºé€»è¾‘ä¿®æ”¹

**æ–‡ä»¶**: `frontend/src/components/layout/PortalLayout.tsx`

```typescript
import { authApi } from '../../api/auth';
import { message } from 'antd';

const onLogout = async () => {
  try {
    // è°ƒç”¨åç«¯ç™»å‡ºæ¥å£
    await authApi.logout();
    message.success('ç™»å‡ºæˆåŠŸ');
  } catch (e: any) {
    // å³ä½¿åç«¯ç™»å‡ºå¤±è´¥ï¼Œå‰ç«¯ä¹Ÿè¦æ¸…é™¤æœ¬åœ°çŠ¶æ€
    console.error('ç™»å‡ºå¤±è´¥', e);
    message.warning('ç™»å‡ºå¤±è´¥ï¼Œä½†å·²æ¸…é™¤æœ¬åœ°ç™»å½•ä¿¡æ¯');
  } finally {
    // æ¸…é™¤å‰ç«¯çŠ¶æ€
    clearToken();
    clearCurrentSessionId(); // å¦‚æœæœ‰ä¼šè¯ID
    navigate('/login');
  }
};
```

---

## ğŸ”§ å››ã€æ–¹æ¡ˆä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

### 4.1 æ”¯æŒå¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½

å¦‚æœéœ€è¦æ”¯æŒç®¡ç†å‘˜å¼ºåˆ¶ä¸‹çº¿æŸä¸ªç”¨æˆ·ï¼š

**æ–‡ä»¶**: `src/main/java/com/ityfz/yulu/admin/controller/AdminUserController.java`

```java
/**
 * å¼ºåˆ¶ä¸‹çº¿ç”¨æˆ·ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
 * POST /api/admin/user/force-logout
 */
@PostMapping("/force-logout")
@RequireRole("ADMIN")
public ApiResponse<Void> forceLogout(@RequestParam Long targetUserId) {
    Long tenantId = SecurityUtil.currentTenantId();
    
    // 1. æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒTokenï¼ˆéœ€è¦ç»´æŠ¤Tokenåˆ—è¡¨ï¼‰
    // 2. å°†æ‰€æœ‰TokenåŠ å…¥é»‘åå•
    // 3. æ¸…é™¤åœ¨çº¿çŠ¶æ€
    
    return ApiResponse.success("å¼ºåˆ¶ä¸‹çº¿æˆåŠŸ");
}
```

**å®ç°è¦ç‚¹**ï¼š
- éœ€è¦ç»´æŠ¤"ç”¨æˆ·-Token"æ˜ å°„å…³ç³»ï¼ˆRedisï¼‰
- ç™»å½•æ—¶å°†Tokenå…³è”åˆ°ç”¨æˆ·ID
- å¼ºåˆ¶ä¸‹çº¿æ—¶æŸ¥è¯¢æ‰€æœ‰Tokenå¹¶åŠ å…¥é»‘åå•

### 4.2 ç™»å‡ºæ—¥å¿—è®°å½•ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è®°å½•ç™»å‡ºæ—¥å¿—ï¼š

**æ–‡ä»¶**: `src/main/java/com/ityfz/yulu/common/entity/LogoutLog.java`

```java
@Data
@TableName("logout_log")
public class LogoutLog {
    private Long id;
    private Long tenantId;
    private Long userId;
    private String role;
    private String ip;
    private String userAgent;
    private LocalDateTime logoutTime;
}
```

---

## ğŸ“Š äº”ã€æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | å®‰å…¨æ€§ | å®ç°å¤æ‚åº¦ | æ€§èƒ½å½±å“ | æ¨èåº¦ |
|------|--------|-----------|---------|--------|
| **çº¯å‰ç«¯ç™»å‡º** | â­ | â­â­â­â­â­ | æ—  | âŒ |
| **åç«¯ç™»å‡º+é»‘åå•** | â­â­â­â­â­ | â­â­â­ | æå° | âœ… **æ¨è** |
| **åç«¯ç™»å‡º+çŸ­è¿‡æœŸ** | â­â­â­ | â­â­â­â­ | æ—  | âš ï¸ |

---

## ğŸ¯ å…­ã€å®æ–½å»ºè®®

### 6.1 å®æ–½æ­¥éª¤

1. **ç¬¬ä¸€æ­¥**ï¼šåˆ›å»º `TokenBlacklistService`
2. **ç¬¬äºŒæ­¥**ï¼šä¿®æ”¹ `JwtAuthFilter`ï¼Œæ·»åŠ é»‘åå•æ£€æŸ¥
3. **ç¬¬ä¸‰æ­¥**ï¼šåˆ›å»º `AuthController`ï¼Œå®ç°ç™»å‡ºæ¥å£
4. **ç¬¬å››æ­¥**ï¼šå‰ç«¯ä¿®æ”¹ç™»å‡ºé€»è¾‘ï¼Œè°ƒç”¨åç«¯æ¥å£
5. **ç¬¬äº”æ­¥**ï¼šæµ‹è¯•éªŒè¯

### 6.2 æ³¨æ„äº‹é¡¹

1. **Rediså†…å­˜**ï¼šé»‘åå•ä¼šå ç”¨Rediså†…å­˜ï¼Œä½†TTLä¼šè‡ªåŠ¨æ¸…ç†
2. **æ€§èƒ½å½±å“**ï¼šæ¯æ¬¡è¯·æ±‚æ£€æŸ¥é»‘åå•ï¼ŒRedisæŸ¥è¯¢å¾ˆå¿«ï¼ˆ<1msï¼‰ï¼Œå½±å“å¯å¿½ç•¥
3. **Tokenè¿‡æœŸæ—¶é—´**ï¼šå»ºè®®è®¾ç½®ä¸º7å¤©ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
4. **å¼‚å¸¸å¤„ç†**ï¼šå³ä½¿åç«¯ç™»å‡ºå¤±è´¥ï¼Œå‰ç«¯ä¹Ÿè¦æ¸…é™¤æœ¬åœ°çŠ¶æ€

---

## âœ… ä¸ƒã€æœ€ç»ˆæ¨è

**æ¨èæ–¹æ¡ˆï¼šåç«¯ç™»å‡ºæ¥å£ + Tokené»‘åå•**

**ç†ç”±**ï¼š
1. âœ… å®‰å…¨æ€§é«˜ï¼ˆTokenç«‹å³å¤±æ•ˆï¼‰
2. âœ… å¯ä»¥æ¸…é™¤æœåŠ¡ç«¯çŠ¶æ€ï¼ˆåœ¨çº¿çŠ¶æ€ã€Redisç¼“å­˜ï¼‰
3. âœ… æ”¯æŒå¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½
4. âœ… ç¬¦åˆä¼ä¸šçº§å®‰å…¨æ ‡å‡†
5. âœ… æ€§èƒ½å½±å“å¯å¿½ç•¥ï¼ˆRedisæŸ¥è¯¢å¾ˆå¿«ï¼‰

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·æ ¹æ®å®ç°è¿›å±•åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£  
**æœ€åæ›´æ–°**: 2026-01-21






